(window.webpackJsonp=window.webpackJsonp||[]).push([[262],{631:function(n,s,a){"use strict";a.r(s);var e=a(40),t=Object(e.a)({},(function(){var n=this,s=n.$createElement,a=n._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[a("h1",{attrs:{id:"nginx-常见中间架构"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx-常见中间架构"}},[n._v("#")]),n._v(" nginx 常见中间架构")]),n._v(" "),a("ul",[a("li",[n._v("静态资源 WEB 服务")]),n._v(" "),a("li",[n._v("代理服务")]),n._v(" "),a("li",[n._v("负载均衡调度器SLB")]),n._v(" "),a("li",[n._v("动态缓存")])]),n._v(" "),a("h2",{attrs:{id:"静态资源-web-服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#静态资源-web-服务"}},[n._v("#")]),n._v(" 静态资源 WEB 服务")]),n._v(" "),a("p",[n._v("部分语法：")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Syntax: sendfile on|off;\nDefault: sendfile off;\nContext: http,location,if in location\n\nSyntax: tcp_nopush on|off;\nDefault: tcp_nopush off;\nContext: http,location,server\n作用：sendfile开启的情况下，提高网络包的传输效率\n\nSyntax: tcp_nodelay on|off;\nDefault: tcp_nodelay off;\nContext: http,location,server\n作用：在keepalive开启的情况下，提高网络包的传输实时性\n\nSyntax: gzip on|off;\nDefault: gzip off;\nContext: http, server, location, if in location\n传输压缩\n\nSyntax: gzip_comp_level level;\nDefault: gzip_comp_level 1;\nContext: http, server, location\n传输压缩等级\n\nSyntax: gzip_http_version 1.0|1.1;\nDefault: gzip_http_version 1.1;\nContext: http, server, location\n传输压缩协议版本，当前主流的是 1.1\n\nhttp://nginx.org/en/docs/http/ngx_http_autoindex_module.html\n目录浏览\n\nrewrite\n重定向\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br"),a("span",{staticClass:"line-number"},[n._v("29")]),a("br"),a("span",{staticClass:"line-number"},[n._v("30")]),a("br"),a("span",{staticClass:"line-number"},[n._v("31")]),a("br"),a("span",{staticClass:"line-number"},[n._v("32")]),a("br"),a("span",{staticClass:"line-number"},[n._v("33")]),a("br"),a("span",{staticClass:"line-number"},[n._v("34")]),a("br")])]),a("h3",{attrs:{id:"拓展nginx压缩模块："}},[a("a",{staticClass:"header-anchor",attrs:{href:"#拓展nginx压缩模块："}},[n._v("#")]),n._v(" 拓展Nginx压缩模块：")]),n._v(" "),a("ul",[a("li",[n._v("http_gzip_static_module 预读gzip功能")]),n._v(" "),a("li",[n._v("http_gunzip_module 应用支持gunzip的压缩方式")])]),n._v(" "),a("h3",{attrs:{id:"缓存"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#缓存"}},[n._v("#")]),n._v(" 缓存")]),n._v(" "),a("p",[n._v("浏览器访问一个页面时会查看本地是否有缓存，如果有则进行缓存是否过期的校验，如果没有过期，则直接 304 到浏览器缓存，如果过期了，则重新向服务器请求。")]),n._v(" "),a("p",[n._v("校验过期机制：")]),n._v(" "),a("ul",[a("li",[n._v("校验是否过期：Expires, Cache-Control(max-age)")]),n._v(" "),a("li",[n._v("协议中Etag头信息校验：Etag")]),n._v(" "),a("li",[n._v("Last-Modified头信息校验：Last-Modified")])]),n._v(" "),a("p",[n._v("配置语法 - expires")]),n._v(" "),a("p",[n._v("添加 Cache-Control, Expires 头")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Syntax: expires [modified] time;\n        expires epoch|max|off;\nDefault: expires off;\nContext: http, server, location, if in location\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br")])]),a("h3",{attrs:{id:"跨域访问"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#跨域访问"}},[n._v("#")]),n._v(" 跨域访问")]),n._v(" "),a("p",[n._v("浏览器禁止跨域访问，防止 CSRF 攻击，nginx 通过添加响应头信息来允许跨域访问")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Syntax: add_header name value [always];\nDefault: --\nContext: http, server, location, if in location\n\n例如：\nadd_header Access-Control-Allow-Origin http://newming.cn\nadd_header Access-Control-Allow-Methods GET,POST,PUT,DELETE,OPTIONS\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br")])]),a("h3",{attrs:{id:"防盗链"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#防盗链"}},[n._v("#")]),n._v(" 防盗链")]),n._v(" "),a("p",[n._v("目的：防止资源被盗用")]),n._v(" "),a("p",[n._v("方式：区别哪些请求是非正常的用户请求")]),n._v(" "),a("p",[n._v("nginx 基于 http_refer 防盗链配置模块")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Syntax: valid_referers none|blocked|server_names|string...;\nDefault: --\nContext: server, location\n其中 none 表示没有携带 refer 的允许，比如直接访问的第一个请求是没有带的。blocked 是表示通过相对路径引用的。\n\nvalid_referers  none blocked 123.56.18.42 ~/newming\\.cn/;\nif ($invalid_referer) {\n  return 403;\n}\n额，这个我这边没有成功。\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br")])]),a("h2",{attrs:{id:"代理服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#代理服务"}},[n._v("#")]),n._v(" 代理服务")]),n._v(" "),a("h3",{attrs:{id:"正向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#正向代理"}},[n._v("#")]),n._v(" 正向代理")]),n._v(" "),a("p",[n._v("客户端 <---\x3e 代理 <--|--\x3e 服务端")]),n._v(" "),a("p",[n._v("常见的应用比如翻墙。")]),n._v(" "),a("h3",{attrs:{id:"反向代理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#反向代理"}},[n._v("#")]),n._v(" 反向代理")]),n._v(" "),a("p",[n._v("客户端 --|-> 代理 <---\x3e 服务端")]),n._v(" "),a("p",[n._v("代理的区别在于代理的对象不一样，正向代理代理的对象是\b客户端，反向代理代理的对象是服务端。")]),n._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[n._v("Syntax: proxy_pass URL;\nDefault: --\nContext: location, if in location, limit_except\n\n缓存区\nSyntax: proxy_buffering on|off;\nDefault: proxy_buffering on;\nContext: server, location\n拓展：proxy_buffer_size, proxy_buffers, proxy_busy_buffers_size\n\n跳转重定向\nSyntax: proxy_redirect default;\nproxy_redirect off;proxy_redirect redirect replacement;\nDefault: proxy_redirect default;\nContext: http, server, location\n\n头信息\nSyntax: proxy_set_header field value;\nDefault: proxy_set_header Host $proxy_host;\n          proxy_set_header Connection close;\nContext: http, server, location\n拓展：proxy_hide_header, proxy_set_body\n\n超时(nginx 作为代理到后端的时间)\nSyntax: proxy_connect_timeout time;\nDefault: proxy_connect_timeout 60s;\nContext: http, server, location\n拓展：proxy_read_timeout, proxy_send_timeout\n")])]),n._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[n._v("1")]),a("br"),a("span",{staticClass:"line-number"},[n._v("2")]),a("br"),a("span",{staticClass:"line-number"},[n._v("3")]),a("br"),a("span",{staticClass:"line-number"},[n._v("4")]),a("br"),a("span",{staticClass:"line-number"},[n._v("5")]),a("br"),a("span",{staticClass:"line-number"},[n._v("6")]),a("br"),a("span",{staticClass:"line-number"},[n._v("7")]),a("br"),a("span",{staticClass:"line-number"},[n._v("8")]),a("br"),a("span",{staticClass:"line-number"},[n._v("9")]),a("br"),a("span",{staticClass:"line-number"},[n._v("10")]),a("br"),a("span",{staticClass:"line-number"},[n._v("11")]),a("br"),a("span",{staticClass:"line-number"},[n._v("12")]),a("br"),a("span",{staticClass:"line-number"},[n._v("13")]),a("br"),a("span",{staticClass:"line-number"},[n._v("14")]),a("br"),a("span",{staticClass:"line-number"},[n._v("15")]),a("br"),a("span",{staticClass:"line-number"},[n._v("16")]),a("br"),a("span",{staticClass:"line-number"},[n._v("17")]),a("br"),a("span",{staticClass:"line-number"},[n._v("18")]),a("br"),a("span",{staticClass:"line-number"},[n._v("19")]),a("br"),a("span",{staticClass:"line-number"},[n._v("20")]),a("br"),a("span",{staticClass:"line-number"},[n._v("21")]),a("br"),a("span",{staticClass:"line-number"},[n._v("22")]),a("br"),a("span",{staticClass:"line-number"},[n._v("23")]),a("br"),a("span",{staticClass:"line-number"},[n._v("24")]),a("br"),a("span",{staticClass:"line-number"},[n._v("25")]),a("br"),a("span",{staticClass:"line-number"},[n._v("26")]),a("br"),a("span",{staticClass:"line-number"},[n._v("27")]),a("br"),a("span",{staticClass:"line-number"},[n._v("28")]),a("br")])])])}),[],!1,null,null,null);s.default=t.exports}}]);