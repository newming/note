(window.webpackJsonp=window.webpackJsonp||[]).push([[260],{625:function(s,t,n){"use strict";n.r(t);var a=n(40),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"nginx-学习笔记"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-学习笔记"}},[s._v("#")]),s._v(" nginx 学习笔记")]),s._v(" "),n("h2",{attrs:{id:"目录"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#目录"}},[s._v("#")]),s._v(" 目录")]),s._v(" "),n("ul",[n("li",[n("RouterLink",{attrs:{to:"/nginx/exec-order.html"}},[s._v("Nginx执行顺序")])],1),s._v(" "),n("li",[n("RouterLink",{attrs:{to:"/nginx/server.html"}},[s._v("nginx 常见中间架构")])],1)]),s._v(" "),n("h2",{attrs:{id:"安装-常用命令"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装-常用命令"}},[s._v("#")]),s._v(" 安装&常用命令")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ubuntu")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mac")]),s._v("\nbrew "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# centos 7 [看这里](https://blog.csdn.net/u012486840/article/details/52610320)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -Uvh http://nginx.org/packages/centos/7/noarch/RPMS/nginx-release-centos-7-0.el7.ngx.noarch.rpm\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" nginx\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("a",{attrs:{href:"http://imshusheng.com/linux/225.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("centos 开机启动 nginx"),n("OutboundLink")],1)]),s._v(" "),n("p",[s._v("nginx 是一个开源且高性能、可靠的HTTP中间件、代理服务。")]),s._v(" "),n("p",[s._v("Mac 位置："),n("code",[s._v("/usr/local/etc/nginx")])]),s._v(" "),n("p",[s._v("常用命令清单：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx start\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx reload\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx status\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v(" nginx stop\n\nnginx -tc /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测配置文件语法")]),s._v("\nnginx -c /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测配置文件语法")]),s._v("\nnginx -s reload -c /etc/nginx/nginx.conf "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重载服务")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("blockquote",[n("p",[s._v("重要：测试位置 /opt 文件夹下")])]),s._v(" "),n("h2",{attrs:{id:"常见的-http-服务"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的-http-服务"}},[s._v("#")]),s._v(" 常见的 HTTP 服务")]),s._v(" "),n("ul",[n("li",[s._v("HTTPD - Apache基金会")]),s._v(" "),n("li",[s._v("IIS - 微软")]),s._v(" "),n("li",[s._v("GWS(google web server) - Google")])]),s._v(" "),n("h2",{attrs:{id:"为什么选择-nginx"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#为什么选择-nginx"}},[s._v("#")]),s._v(" 为什么选择 nginx")]),s._v(" "),n("p",[s._v("原因1: IO 多路复用 epoll(解决高并发)")]),s._v(" "),n("p",[s._v("多个描述符的 I/O 操作都能在一个线程内并发交替的顺序完成，这就叫 I/O 多路复用，这里的”复用“指的是复用同一个线程。")]),s._v(" "),n("h3",{attrs:{id:"epoll-和-select-模式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#epoll-和-select-模式"}},[s._v("#")]),s._v(" epoll 和 select 模式")]),s._v(" "),n("p",[s._v("select 模型的缺点")]),s._v(" "),n("ul",[n("li",[s._v("能够监视文件描述符的数量存在最大限制")]),s._v(" "),n("li",[s._v("线性扫描效率低下")])]),s._v(" "),n("p",[s._v("epoll 模型")]),s._v(" "),n("ul",[n("li",[s._v("每当 FD 就绪，采用系统的毁掉函数直接将 fd 放入，效率更高")]),s._v(" "),n("li",[s._v("最大连接无限制")])]),s._v(" "),n("p",[s._v("原因二: 轻量级")]),s._v(" "),n("ul",[n("li",[s._v("功能模块少")]),s._v(" "),n("li",[s._v("代码模块化")])]),s._v(" "),n("p",[s._v("原因三: CPU 亲和(affinity)")]),s._v(" "),n("p",[s._v("CPU 亲和：是一种把CPU核心喝nginx工作进程绑定方式，把每个worker进程固定在一个cpu上执行，减少切换cpu的cache miss，获得更好的性能。")]),s._v(" "),n("p",[s._v("原因四: sendfile 的工作机制")]),s._v(" "),n("h2",{attrs:{id:"安装目录讲解-centos"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装目录讲解-centos"}},[s._v("#")]),s._v(" 安装目录讲解(centos)")]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("路径")]),s._v(" "),n("th",[s._v("类型")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("/etc/logrotate.d/nginx")]),s._v(" "),n("td",[s._v("配置文件")]),s._v(" "),n("td",[s._v("Nginx 日志轮转，用于 logrotate 服务的日志切割")])]),s._v(" "),n("tr",[n("td",[s._v("/etc/nginx"),n("br"),s._v("/etc/nginx/nginx.conf"),n("br"),s._v("/etc/nginx/conf.d"),n("br"),s._v("/etc/nginx/conf.d/default.conf")]),s._v(" "),n("td",[s._v("目录、配置文件")]),s._v(" "),n("td",[s._v("Nginx 主配置文件")])]),s._v(" "),n("tr",[n("td",[s._v("/etc/nginx/fastcgi_params"),n("br"),s._v("/etc/nginx/uwsgi_params"),n("br"),s._v("/etc/nginx/scgi_params")]),s._v(" "),n("td",[s._v("配置文件")]),s._v(" "),n("td",[s._v("cgi配置相关，fastcgi配置")])]),s._v(" "),n("tr",[n("td",[s._v("/etc/nginx/koi-utf"),n("br"),s._v("/etc/nginx/koi-win"),n("br"),s._v("/etc/nginx/win-utf")]),s._v(" "),n("td",[s._v("配置文件")]),s._v(" "),n("td",[s._v("编码转换映射转化文件(少用)")])]),s._v(" "),n("tr",[n("td",[s._v("/etc/nginx/mime.types")]),s._v(" "),n("td",[s._v("配置文件")]),s._v(" "),n("td",[s._v("设置http协议的 "),n("code",[s._v("Content-Type")]),s._v(" 与拓展名对应关系")])]),s._v(" "),n("tr",[n("td",[s._v("/usr/lib/systemd/system/nginx-debug.service"),n("br"),s._v("/usr/lib/systemd/system/nginx.service"),n("br"),s._v("/etc/sysconfig/nginx"),n("br"),s._v("/etc/sysconfig/nginx-debug")]),s._v(" "),n("td",[s._v("配置文件")]),s._v(" "),n("td",[s._v("用于配置出系统守护进程管理器管理方式")])]),s._v(" "),n("tr",[n("td",[s._v("/usr/lib64/nginx/modules"),n("br"),s._v("/etc/nginx/modules")]),s._v(" "),n("td",[s._v("目录")]),s._v(" "),n("td",[s._v("Nginx 模块目录")])]),s._v(" "),n("tr",[n("td",[s._v("/usr/sbin/nginx"),n("br"),s._v("/usr/sbin/nginx-debug")]),s._v(" "),n("td",[s._v("命令")]),s._v(" "),n("td",[s._v("Nginx 服务的启动管理的终端命令")])]),s._v(" "),n("tr",[n("td",[s._v("/usr/share/nginx"),n("br"),s._v("/usr/share/nginx/COPYRIGHT"),n("br"),s._v("/usr/share/man/man8")]),s._v(" "),n("td",[s._v("命令")]),s._v(" "),n("td",[s._v("Nginx 服务的启动管理的终端命令")])]),s._v(" "),n("tr",[n("td",[s._v("/usr/share/nginx"),n("br"),s._v("/usr/share/nginx/COPYRIGHT"),n("br"),s._v("/usr/share/man/man8/nginx")]),s._v(" "),n("td",[s._v("文件、目录")]),s._v(" "),n("td",[s._v("nginx 的手册和帮助文件")])]),s._v(" "),n("tr",[n("td",[s._v("/var/cache/nginx")]),s._v(" "),n("td",[s._v("目录")]),s._v(" "),n("td",[s._v("nginx 的缓存目录")])]),s._v(" "),n("tr",[n("td",[s._v("/var/log/nginx")]),s._v(" "),n("td",[s._v("目录")]),s._v(" "),n("td",[s._v("nginx 的日志目录")])])])]),s._v(" "),n("h2",{attrs:{id:"安装编译参数"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装编译参数"}},[s._v("#")]),s._v(" 安装编译参数")]),s._v(" "),n("p",[s._v("命令：")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("nginx -V\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mac 输出内容")]),s._v("\n--prefix"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/Cellar/nginx/1.12.1\n--with-http_ssl_module\n--with-pcre\n--sbin-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/Cellar/nginx/1.12.1/bin/nginx\n--with-cc-opt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-I/usr/local/opt/pcre/include -I/usr/local/opt/openssl@1.1/include'")]),s._v("\n--with-ld-opt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'-L/usr/local/opt/pcre/lib -L/usr/local/opt/openssl@1.1/lib'")]),s._v("\n--conf-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/etc/nginx/nginx.conf\n--pid-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx.pid\n--lock-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx.lock\n--http-client-body-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx/client_body_temp\n--http-proxy-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx/proxy_temp\n--http-fastcgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx/fastcgi_temp\n--http-uwsgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx/uwsgi_temp\n--http-scgi-temp-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/run/nginx/scgi_temp\n--http-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/log/nginx/access.log\n--error-log-path"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/var/log/nginx/error.log\n--with-http_gzip_static_module\n--with-http_v2_module\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("table",[n("thead",[n("tr",[n("th",[s._v("编译选项")]),s._v(" "),n("th",[s._v("作用")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("--prefix"),n("br"),s._v("--sbin-path"),n("br"),s._v("--module-path"),n("br"),s._v("--conf-path"),n("br"),s._v("--error-log-path"),n("br"),s._v("--http-log-path"),n("br"),s._v("--pid-path"),n("br"),s._v("--lock-path")]),s._v(" "),n("td",[s._v("安装目录或路径")])]),s._v(" "),n("tr",[n("td",[s._v("--http-client-body-temp-path"),n("br"),s._v("--http-proxy-temp-path"),n("br"),s._v("--http-fastcgi-temp-path"),n("br"),s._v("--http-uwsgi-temp-path"),n("br"),s._v("--http-scgi-temp-path")]),s._v(" "),n("td",[s._v("执行对应模块时，Nginx所保留的临时性文件")])]),s._v(" "),n("tr",[n("td",[s._v("--user=nginx"),n("br"),s._v("--group=nginx")]),s._v(" "),n("td",[s._v("设定Nginx进程启动的用户和组用户")])]),s._v(" "),n("tr",[n("td",[s._v("--with-cc-opt")]),s._v(" "),n("td",[s._v("设置额外的参数将被添加到CFLAGS变量")])]),s._v(" "),n("tr",[n("td",[s._v("--with-ld-opt")]),s._v(" "),n("td",[s._v("设置附加的参数，链接系统库")])])])]),s._v(" "),n("h2",{attrs:{id:"nginx-配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-配置文件"}},[s._v("#")]),s._v(" Nginx 配置文件")]),s._v(" "),n("blockquote",[n("p",[s._v("/usr/local/etc/nginx/nginx.conf")])]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#user  nobody;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_processes")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  notice;")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_log  logs/error.log  info;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#pid        logs/nginx.pid;")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("events")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("worker_connections")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v("       mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# content-type 的配置文件")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("default_type")]),s._v("  application"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("octet"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("stream"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#log_format  main  '$remote_addr - $remote_user [$time_local] \"$request\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#                  '$status $body_bytes_sent \"$http_referer\" '")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('#                  \'"$http_user_agent" "$http_x_forwarded_for"\';')]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/access.log  main; # 访问日志位置")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sendfile")]),s._v("        on"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 发送文件，Nginx的优势")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#tcp_nopush     on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#keepalive_timeout  0;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("keepalive_timeout")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("65")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 客户端与服务端的超时时间 65s")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#gzip  on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server 所监听的端口")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v("  localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# server name")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#charset koi8-r;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#access_log  logs/host.access.log  main;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首页路径进入到这里，可以有多个location")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首页路径，文件夹")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("index")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("htm"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 首页默认返回的文件")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#error_page  404              /404.html;")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redirect server error pages to the static page /50x.html")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("error_page")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("500")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("502")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("503")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("504")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 错误页面")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("50")]),s._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("html "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("root")]),s._v("   html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# proxy the PHP scripts to Apache listening on 127.0.0.1:80")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ { # ~ 开头代表模式匹配")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    proxy_pass   http://127.0.0.1;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ \\.php$ {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    root           html;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_pass   127.0.0.1:9000;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_index  index.php;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    include        fastcgi_params;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# deny access to .htaccess files, if Apache's document root")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# concurs with nginx's one")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#location ~ /\\.ht {")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    deny  all;")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# another virtual host using mix of IP-, name-, and port-based configuration")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       8000;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       somename:8080;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name  somename  alias  another.alias;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location / {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        root   html;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        index  index.html index.htm;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HTTPS server")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#server {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    listen       443 ssl;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    server_name  localhost;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_certificate      cert.pem;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_certificate_key  cert.key;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_session_cache    shared:SSL:1m;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_session_timeout  5m;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_ciphers  HIGH:!aNULL:!MD5;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    ssl_prefer_server_ciphers  on;")]),s._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    location / {")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        root   html;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        index  index.html index.htm;")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    }")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" servers"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Nginx 代理规则配置文件所在地址")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br"),n("span",{staticClass:"line-number"},[s._v("63")]),n("br"),n("span",{staticClass:"line-number"},[s._v("64")]),n("br"),n("span",{staticClass:"line-number"},[s._v("65")]),n("br"),n("span",{staticClass:"line-number"},[s._v("66")]),n("br"),n("span",{staticClass:"line-number"},[s._v("67")]),n("br"),n("span",{staticClass:"line-number"},[s._v("68")]),n("br"),n("span",{staticClass:"line-number"},[s._v("69")]),n("br"),n("span",{staticClass:"line-number"},[s._v("70")]),n("br"),n("span",{staticClass:"line-number"},[s._v("71")]),n("br"),n("span",{staticClass:"line-number"},[s._v("72")]),n("br"),n("span",{staticClass:"line-number"},[s._v("73")]),n("br"),n("span",{staticClass:"line-number"},[s._v("74")]),n("br"),n("span",{staticClass:"line-number"},[s._v("75")]),n("br"),n("span",{staticClass:"line-number"},[s._v("76")]),n("br"),n("span",{staticClass:"line-number"},[s._v("77")]),n("br"),n("span",{staticClass:"line-number"},[s._v("78")]),n("br"),n("span",{staticClass:"line-number"},[s._v("79")]),n("br"),n("span",{staticClass:"line-number"},[s._v("80")]),n("br"),n("span",{staticClass:"line-number"},[s._v("81")]),n("br"),n("span",{staticClass:"line-number"},[s._v("82")]),n("br"),n("span",{staticClass:"line-number"},[s._v("83")]),n("br"),n("span",{staticClass:"line-number"},[s._v("84")]),n("br"),n("span",{staticClass:"line-number"},[s._v("85")]),n("br"),n("span",{staticClass:"line-number"},[s._v("86")]),n("br"),n("span",{staticClass:"line-number"},[s._v("87")]),n("br"),n("span",{staticClass:"line-number"},[s._v("88")]),n("br"),n("span",{staticClass:"line-number"},[s._v("89")]),n("br"),n("span",{staticClass:"line-number"},[s._v("90")]),n("br"),n("span",{staticClass:"line-number"},[s._v("91")]),n("br"),n("span",{staticClass:"line-number"},[s._v("92")]),n("br"),n("span",{staticClass:"line-number"},[s._v("93")]),n("br"),n("span",{staticClass:"line-number"},[s._v("94")]),n("br"),n("span",{staticClass:"line-number"},[s._v("95")]),n("br"),n("span",{staticClass:"line-number"},[s._v("96")]),n("br"),n("span",{staticClass:"line-number"},[s._v("97")]),n("br"),n("span",{staticClass:"line-number"},[s._v("98")]),n("br"),n("span",{staticClass:"line-number"},[s._v("99")]),n("br"),n("span",{staticClass:"line-number"},[s._v("100")]),n("br"),n("span",{staticClass:"line-number"},[s._v("101")]),n("br"),n("span",{staticClass:"line-number"},[s._v("102")]),n("br"),n("span",{staticClass:"line-number"},[s._v("103")]),n("br"),n("span",{staticClass:"line-number"},[s._v("104")]),n("br"),n("span",{staticClass:"line-number"},[s._v("105")]),n("br"),n("span",{staticClass:"line-number"},[s._v("106")]),n("br"),n("span",{staticClass:"line-number"},[s._v("107")]),n("br"),n("span",{staticClass:"line-number"},[s._v("108")]),n("br"),n("span",{staticClass:"line-number"},[s._v("109")]),n("br"),n("span",{staticClass:"line-number"},[s._v("110")]),n("br"),n("span",{staticClass:"line-number"},[s._v("111")]),n("br"),n("span",{staticClass:"line-number"},[s._v("112")]),n("br"),n("span",{staticClass:"line-number"},[s._v("113")]),n("br"),n("span",{staticClass:"line-number"},[s._v("114")]),n("br")])]),n("h2",{attrs:{id:"nginx-日志类型"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-日志类型"}},[s._v("#")]),s._v(" Nginx 日志类型")]),s._v(" "),n("p",[s._v("包括：error.log, access_log。通过 log_format 字段配置。")]),s._v(" "),n("p",[s._v('Syntax: log_format name [escape=default|json] string ...;\nDefault: log_format combined "...";\nContext: http // 只能配置在 http 这个属性下')]),s._v(" "),n("h2",{attrs:{id:"nginx-变量"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-变量"}},[s._v("#")]),s._v(" Nginx 变量")]),s._v(" "),n("p",[s._v("Nginx 变量都是以 $ 开头")]),s._v(" "),n("ul",[n("li",[s._v("HTTP 请求变量: arg_PARAMETER, http_HEADER, sent_http_HEADER 例如：$http_user_agent，要将http请求中的 "),n("code",[s._v("-")]),s._v(" 改为 "),n("code",[s._v("_")]),s._v("，并且小写")]),s._v(" "),n("li",[s._v("内置变量: Nginx 内置的，比较多。"),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_log_module.html#log_format",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),n("OutboundLink")],1)]),s._v(" "),n("li",[s._v("自定义变量: 自己定义")])]),s._v(" "),n("h2",{attrs:{id:"nginx-模块"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nginx-模块"}},[s._v("#")]),s._v(" Nginx 模块")]),s._v(" "),n("ul",[n("li",[s._v("Nginx 官方模块")]),s._v(" "),n("li",[s._v("第三方模块")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用的模块查询")]),s._v("\nnginx -V "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# --with-* 的为 nginx 开启的模块")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("http_stub_status_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_stub_status_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" Nginx 的客户端状态，用于监控 Nginx 的当前连接信息。(Mac 开启失败。)")]),s._v(" "),n("li",[s._v("http_random_index_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_random_index_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" 目录中选择一个随机主页")]),s._v(" "),n("li",[s._v("http_sub_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_sub_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" HTTP 内容替换，在 Response 的时候替换内容")]),s._v(" "),n("li",[s._v("http_limit_conn_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_limit_conn_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" 连接频率限制")]),s._v(" "),n("li",[s._v("http_limit_req_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_limit_req_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" 请求频率限制")]),s._v(" "),n("li",[s._v("http_access_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_access_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" 限制确定的ip连接或拒绝，局限：可以使用代理绕过ip限制。方案一：http_x_forwarded_for 属性会始终携带经过个层代理的 ip。http_x_forwarded_for = Client IP,Proxy(1)IP,Proxy(2)IP,...方案二：结合geo模块作。方案三：通过HTTP自定义变量传递")]),s._v(" "),n("li",[s._v("http_auth_basic_module: "),n("a",{attrs:{href:"http://nginx.org/en/docs/http/ngx_http_auth_basic_module.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方"),n("OutboundLink")],1),s._v(" 验证身份。局限性：用户信息依赖文件方式、操作管理机械，效率低下。解决方案：Nginx结合LUA实现高效验证、Nginx和LDAP打通，利用nginx-auth-ldap模块")])]),s._v(" "),n("table",[n("thead",[n("tr",[n("th",[s._v("HTTP协议版本")]),s._v(" "),n("th",[s._v("连接关系")])])]),s._v(" "),n("tbody",[n("tr",[n("td",[s._v("HTTP1.0")]),s._v(" "),n("td",[s._v("TCP 不能复用")])]),s._v(" "),n("tr",[n("td",[s._v("HTTP1.1")]),s._v(" "),n("td",[s._v("顺序性 TCP 复用")])]),s._v(" "),n("tr",[n("td",[s._v("HTTP2.0")]),s._v(" "),n("td",[s._v("多路复用，TCP 复用")])])])]),s._v(" "),n("p",[s._v("HTTP 请求建立在一次TCP连接基础上")]),s._v(" "),n("p",[s._v("一次 TCP 请求至少产生一次 HTTP 请求")]),s._v(" "),n("h2",{attrs:{id:"调试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#调试"}},[s._v("#")]),s._v(" 调试")]),s._v(" "),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" test"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("com"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("add_header")]),s._v(" Content"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Type "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"text/plain;charset-utf-8"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"$http_host"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language-nginx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-nginx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("upstream")]),s._v(" cnode "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".0")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v(".1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5000")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("server_name")]),s._v(" example"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("location")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Real"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("IP "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$remote_addr")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Forward"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("For "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$proxy_add_x_forwarded_for")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" Host "),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$http_host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_set_header")]),s._v(" X"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("Nginx"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Proxy")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_pass")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("http")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("cnode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("proxy_redirect")]),s._v(" off"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("listen")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("letsencrypt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("live"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("newming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("fullchain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_certificate_key")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("letsencrypt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("live"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("newming"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cn"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("privkey"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("include")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("letsencrypt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("options"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("conf"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl_dhparam")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("etc"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("letsencrypt"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ssl")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("dhparams"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("pem"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n\n\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$scheme")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"https"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("301")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("https")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$host")]),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$request_uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# managed by Certbot")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])])])}),[],!1,null,null,null);t.default=e.exports}}]);